{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}

    Task <span id="cur_task_num">{{ player.cur_task_num }}</span> out of {{ player.total_tasks }}
{% endblock %}

{% block content %}
    <div class="container-fluid">
        <div class="row">
            <div class="col justify-content-center d-flex align-items-center flex-column">
                <div>Calculate how many "<span id="item_to_count"></span>" are here:</div>
                <div id="body"></div>

                <div class="d-flex flex-row m-3">
                    <input type="number" class="form-control" id="answer_num">

                    <button class="btn btn-lg btn-success" type="button" role="button" id="answer_btn">
                        Answer
                    </button>
                </div>

            </div>
        </div>
    </div>
    <script>
        const $answer_input = $('#answer_num')
        let currentId, item_to_check, body, no_tasks_left, cur_task_num;
        $(() => {
            $answer_input.focus();
            liveSend({handshake: true, page: js_vars['name']})

        })
        const liveRecv = (data) => {
            console.debug('received a message!', data);
            ({id: currentId, item_to_check, body, no_tasks_left, cur_task_num} = data);
            if (no_tasks_left) {
                $('#form').submit()
            }
            $('#cur_task_num').html(cur_task_num || '')
            $('#item_to_count').html(item_to_check || '')
            $('#body').html(body || '')

        }

        $('#answer_btn').click(() => {

            const val = $answer_input.val();

            if (val) {
                liveSend({answer: val, id: currentId})
                $answer_input.val(null)
                $answer_input.focus();
            }

        })
    </script>
    {% formfields %}

{% endblock %}
